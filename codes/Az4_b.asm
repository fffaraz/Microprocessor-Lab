/*
 * AssemblerApplication1.asm
 *
 *  Created: 4/5/2014 6:27:14 AM
 *   Author: Ali and kurosh
 */ 
 

 .include "m32def.inc"
 .equ LCD_PORTB = PORTB 
 .equ EN = 2 
 .equ RW = 1
 .equ RS = 0 
 .def LCD_DATA = R17
 .def TEMP = R16


 .org 0x0000
 jmp main
 .org 0x0030

 MAIN:
 
    LDI R20 , HIGH(RAMEND)	
	OUT SPH , R20

    LDI R20 , LOW(RAMEND)
	OUT SPL , R20

 CALL LCD_INIT	
 CALL DELAY


 LDI LCD_DATA , 'M' 
 CALL LCD_DISP
 CALL DELAY

  LDI LCD_DATA , 'i'
 CALL LCD_DISP
 CALL DELAY

  LDI LCD_DATA , 'c'
 CALL LCD_DISP
 CALL DELAY

 LDI LCD_DATA , 'r'
 CALL LCD_DISP
 CALL DELAY

 LDI LCD_DATA , 'o'
 CALL LCD_DISP
 CALL DELAY

 LDI LCD_DATA , 'L'
 CALL LCD_DISP
 CALL DELAY

 LDI LCD_DATA , 'a'
 CALL LCD_DISP
 CALL DELAY

 LDI LCD_DATA , 'b'
 CALL LCD_DISP
 CALL DELAY

 FINISH:
 JMP FINISH


 LCD_INIT:	

 LDI TEMP , 0XFF 
 OUT DDRB , TEMP

 LDI LCD_DATA , 0B00100000
 CALL LCD_CMD
 CALL DELAY

 
 LDI LCD_DATA , 0B00101000 
 CALL LCD_CMD
 CALL DELAY

  LDI LCD_DATA , 0B00101000 ; 
 CALL LCD_CMD
 CALL DELAY

  LDI LCD_DATA , 0B00101000
 CALL LCD_CMD
 CALL DELAY
 
 LDI LCD_DATA , 1 
 CALL LCD_CMD
 CALL DELAY

 LDI LCD_DATA , 0B00001100	
 CALL LCD_CMD
 CALL DELAY

 LDI LCD_DATA , 0B00000110 
 CALL LCD_CMD
 CALL DELAY

 RET


 LCD_CMD:	
 
 LDI TEMP , 0XF0
 AND TEMP , LCD_DATA
 OUT LCD_PORTB , TEMP 

 SBI  LCD_PORTB, EN
 NOP
 NOP
 NOP
 CBI LCD_PORTB , EN

 ;LDI TEMP , 0X0F
 ;AND TEMP , LCD_DATA
 ;SWAP TEMP
 ;OUT LCD_PORTB , TEMP 

 ;SBI LCD_PORTB , EN
 ;NOP
 ;NOP
 ;NOP
 ;CBI LCD_PORTB , EN

 RET

 LCD_DISP: 

 LDI TEMP , 0XF0
 AND TEMP , LCD_DATA
 OUT LCD_PORTB , TEMP 

 SBI LCD_PORTB , EN
 SBI LCD_PORTB , RS 
 NOP
 NOP
 NOP
 CBI LCD_PORTB , EN
 CBI LCD_PORTB , RS

 LDI TEMP , 0X0F
 AND TEMP , LCD_DATA
 SWAP TEMP
 OUT LCD_PORTB , TEMP

 SBI LCD_PORTB , EN
 SBI LCD_PORTB , RS
 NOP
 NOP
 NOP
 CBI LCD_PORTB , EN
 CBI LCD_PORTB , RS

 RET

 DELAY:	
 LDI R21 , 0XFF
 LOOP3:
 LDI R22 , 0XFF
 LOOP2:
NOP
NOP
NOP
NOP
NOP
NOP
DEC R22
BRNE LOOP2
DEC R21
 BRNE LOOP3

 RET

