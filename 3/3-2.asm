.INCLUDE "M32DEF.INC"

.ORG 0
JMP RESET

.ORG 32
RESET:

LDI R16, LOW(RAMEND)
OUT SPL, R16
LDI R16, HIGH(RAMEND)
OUT SPH, R16

SER R16
OUT DDRC, R16

LOOP: 

LDI R16, 0b11000000
OUT ADCSRA, R16

CHECK:
IN R16, ADCSRA
ANDI R16, 0b00010000
BREQ CHECK

CALL DECODE
JMP LOOP

DECODE:
IN R16, ADCL
IN R17, ADCH

		CPI R16, 51
		BRSH	L1
		LDI R18, 0b00000001
		JMP END

L1:
		CPI R16, 102
		BRSH	L2
		LDI R18, 0b00000011
		JMP END

L2:
		CPI R16, 153
		BRSH	L3
		LDI R18, 0b00000111
		JMP END
L3:
		CPI R16, 204
		BRSH	L4
		LDI R18, 0b00001111
		JMP END

L4:
		CPI R16, 255
		BRSH	L5
		LDI R18, 0b00011111
		JMP END

L5:
		LDI R18, 0b00111111

END:
	OUT PORTC, R18
	RET
